<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SweetAlert2 y Notificaciones</title>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            background: #cc7710;
            color: white;
        }
        
        button:hover {
            background: #b5690e;
        }
        
        .error-log {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        
        .section h3 {
            color: #cc7710;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test de Notificaciones - Sistema de Reservas</h1>
        
        <div class="section">
            <h3>1. Test de Carga de SweetAlert2</h3>
            <button onclick="testSweetAlert2Load()">Verificar si SweetAlert2 est√° cargado</button>
        </div>
        
        <div class="section">
            <h3>2. Test de Notificaciones SweetAlert2</h3>
            <button onclick="testSuccessNotification()">Test √âxito</button>
            <button onclick="testErrorNotification()">Test Error</button>
            <button onclick="testWarningNotification()">Test Advertencia</button>
            <button onclick="testInfoNotification()">Test Info</button>
        </div>
        
        <div class="section">
            <h3>3. Test de Notificaci√≥n de Reserva</h3>
            <button onclick="testReservationSuccess()">Test Reserva Exitosa</button>
            <button onclick="testReservationError()">Test Error de Reserva</button>
        </div>
        
        <div class="section">
            <h3>4. Test de Conexi√≥n al API</h3>
            <button onclick="testAPIConnection()">Test API Disponibilidad</button>
            <button onclick="testCreateReservation()">Test Crear Reserva</button>
        </div>
        
        <div class="section">
            <h3>5. Test de Scripts de Landing</h3>
            <button onclick="testLandingScripts()">Verificar Scripts de Landing</button>
        </div>
        
        <div class="error-log" id="log">
            <strong>Log de Pruebas:</strong><br>
        </div>
    </div>

    <script>
        // ===== FUNCIONES DE TEST =====
        
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'color: red;' : type === 'success' ? 'color: green;' : 'color: blue;';
            logElement.innerHTML += `<div style="${colorClass}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function testSweetAlert2Load() {
            log('Verificando carga de SweetAlert2...', 'info');
            
            if (typeof Swal !== 'undefined') {
                log('‚úÖ SweetAlert2 est√° cargado correctamente', 'success');
                log(`Version: ${Swal.version || 'desconocida'}`, 'info');
            } else {
                log('‚ùå SweetAlert2 NO est√° cargado', 'error');
            }
        }
        
        function testSuccessNotification() {
            log('Mostrando notificaci√≥n de √©xito...', 'info');
            try {
                Swal.fire({
                    title: '¬°√âxito!',
                    text: 'Esta es una notificaci√≥n de prueba exitosa',
                    icon: 'success',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#cc7710'
                });
                log('‚úÖ Notificaci√≥n de √©xito mostrada', 'success');
            } catch (error) {
                log(`‚ùå Error al mostrar notificaci√≥n: ${error.message}`, 'error');
            }
        }
        
        function testErrorNotification() {
            log('Mostrando notificaci√≥n de error...', 'info');
            try {
                Swal.fire({
                    title: 'Error',
                    text: 'Esta es una notificaci√≥n de error de prueba',
                    icon: 'error',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#cc7710'
                });
                log('‚úÖ Notificaci√≥n de error mostrada', 'success');
            } catch (error) {
                log(`‚ùå Error al mostrar notificaci√≥n: ${error.message}`, 'error');
            }
        }
        
        function testWarningNotification() {
            log('Mostrando notificaci√≥n de advertencia...', 'info');
            try {
                Swal.fire({
                    title: 'Atenci√≥n',
                    text: 'Esta es una notificaci√≥n de advertencia de prueba',
                    icon: 'warning',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#cc7710'
                });
                log('‚úÖ Notificaci√≥n de advertencia mostrada', 'success');
            } catch (error) {
                log(`‚ùå Error al mostrar notificaci√≥n: ${error.message}`, 'error');
            }
        }
        
        function testInfoNotification() {
            log('Mostrando notificaci√≥n de informaci√≥n...', 'info');
            try {
                Swal.fire({
                    title: 'Informaci√≥n',
                    text: 'Esta es una notificaci√≥n de informaci√≥n de prueba',
                    icon: 'info',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#cc7710',
                    timer: 3000,
                    timerProgressBar: true
                });
                log('‚úÖ Notificaci√≥n de informaci√≥n mostrada', 'success');
            } catch (error) {
                log(`‚ùå Error al mostrar notificaci√≥n: ${error.message}`, 'error');
            }
        }
        
        function testReservationSuccess() {
            log('Mostrando notificaci√≥n de reserva exitosa...', 'info');
            try {
                const details = {
                    roomName: 'Habitaci√≥n Est√°ndar',
                    roomNumber: '131',
                    checkIn: '2025-09-04',
                    checkOut: '2025-09-05',
                    nights: 1,
                    total: 100000
                };
                
                const htmlContent = `
                    <div style="text-align: left; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #cc7710;">üìã Detalles de tu Reserva</h4>
                            <p style="margin: 5px 0;"><strong>üè† Habitaci√≥n:</strong> ${details.roomName} #${details.roomNumber}</p>
                            <p style="margin: 5px 0;"><strong>üìÖ Llegada:</strong> ${details.checkIn}</p>
                            <p style="margin: 5px 0;"><strong>üìÖ Salida:</strong> ${details.checkOut}</p>
                            <p style="margin: 5px 0;"><strong>üåô Noches:</strong> ${details.nights}</p>
                            <p style="margin: 5px 0;"><strong>üí∞ Total estimado:</strong> $${details.total.toLocaleString()}</p>
                        </div>
                        <p style="margin: 15px 0; color: #666;">Te contactaremos pronto para confirmar todos los detalles de tu estad√≠a.</p>
                    </div>
                `;
                
                Swal.fire({
                    title: '¬°Reserva Enviada Exitosamente!',
                    html: htmlContent,
                    icon: 'success',
                    confirmButtonText: '¬°Perfecto!',
                    confirmButtonColor: '#cc7710'
                });
                log('‚úÖ Notificaci√≥n de reserva exitosa mostrada', 'success');
            } catch (error) {
                log(`‚ùå Error al mostrar notificaci√≥n de reserva: ${error.message}`, 'error');
            }
        }
        
        function testReservationError() {
            log('Mostrando notificaci√≥n de error de reserva...', 'info');
            try {
                Swal.fire({
                    title: 'Error en la Reserva',
                    text: 'La habitaci√≥n 131 ya no est√° disponible para las fechas seleccionadas. La reserva ha expirado.',
                    icon: 'error',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#cc7710'
                });
                log('‚úÖ Notificaci√≥n de error de reserva mostrada', 'success');
            } catch (error) {
                log(`‚ùå Error al mostrar notificaci√≥n de error de reserva: ${error.message}`, 'error');
            }
        }
        
        async function testAPIConnection() {
            log('Probando conexi√≥n al API de disponibilidad...', 'info');
            try {
                const response = await fetch('/api/reservas/disponibilidad?fecha_entrada=2025-09-04&fecha_salida=2025-09-05&huespedes=1', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                log(`Response status: ${response.status}`, 'info');
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ API de disponibilidad funciona correctamente', 'success');
                    log(`Habitaciones disponibles: ${data.data?.habitaciones_disponibles?.length || 0}`, 'info');
                    
                    // Buscar habitaci√≥n 131
                    if (data.data?.habitaciones_disponibles) {
                        const habitacion131 = data.data.habitaciones_disponibles.find(h => h.numero === '131');
                        if (habitacion131) {
                            log('‚úÖ Habitaci√≥n 131 est√° disponible en la respuesta', 'success');
                            log(`Estado de 131: ${habitacion131.estado}`, 'info');
                        } else {
                            log('‚ùå Habitaci√≥n 131 NO est√° en la respuesta', 'error');
                        }
                    }
                } else {
                    log(`‚ùå Error en API: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error de conexi√≥n API: ${error.message}`, 'error');
            }
        }
        
        async function testCreateReservation() {
            log('Probando creaci√≥n de reserva...', 'info');
            try {
                const reservationData = {
                    habitacion_id: 5, // ID de habitaci√≥n 131
                    fecha_entrada: '2025-09-04',
                    fecha_salida: '2025-09-05',
                    adelanto: 0,
                    cliente_nombre: 'Test User',
                    cliente_telefono: '1234567890',
                    cliente_email: 'test@example.com',
                    observaciones: 'Reserva de prueba'
                };
                
                const response = await fetch('/api/reservas', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(reservationData)
                });
                
                log(`Response status: ${response.status}`, 'info');
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ API de reservas funciona correctamente', 'success');
                    log(`Respuesta: ${JSON.stringify(data, null, 2)}`, 'info');
                } else {
                    const errorText = await response.text();
                    log(`‚ùå Error en creaci√≥n de reserva: ${response.status}`, 'error');
                    log(`Detalles: ${errorText}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error en creaci√≥n de reserva: ${error.message}`, 'error');
            }
        }
        
        function testLandingScripts() {
            log('Verificando scripts de landing...', 'info');
            
            // Verificar si est√°n cargados los scripts
            const scripts = [
                'checkAvailability',
                'createReservation', 
                'showSuccessMessage',
                'showErrorMessage',
                'openReservationModal',
                'closeReservationModal'
            ];
            
            scripts.forEach(script => {
                if (typeof window[script] === 'function') {
                    log(`‚úÖ ${script} est√° disponible`, 'success');
                } else {
                    log(`‚ùå ${script} NO est√° disponible`, 'error');
                }
            });
            
            // Verificar configuraciones
            if (typeof window.API_CONFIG !== 'undefined') {
                log('‚úÖ API_CONFIG est√° cargado', 'success');
                log(`Base URL: ${window.API_CONFIG.BASE_URL}`, 'info');
            } else {
                log('‚ùå API_CONFIG NO est√° cargado', 'error');
            }
        }
        
        // Auto-ejecutar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            log('P√°gina de pruebas cargada', 'info');
            testSweetAlert2Load();
        });
    </script>
</body>
</html>
